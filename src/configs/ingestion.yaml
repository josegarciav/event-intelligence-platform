# Configuration for Ingestion Pipelines
# This file defines which sources are enabled, their settings,
# scheduling, and source-specific configuration.

sources:

  # =========================================================================
  # RA.CO - GraphQL API-based ingestion
  # =========================================================================
  ra_co:
    enabled: true
    type: "api"

    # API Settings
    graphql_endpoint: "https://ra.co/graphql"
    request_timeout: 30
    max_retries: 3
    batch_size: 50
    rate_limit_per_second: 1.0

    # Default filters
    defaults:
      area_id: 20  # Barcelona
      page_size: 50
      days_ahead: 30

    # Scheduling
    schedule:
      type: "interval"
      interval_hours: 12
      enabled: true

    # Enrichment options
    enrichment:
      geocoding: true

    # Validation rules
    validation:
      future_events_only: true
      days_ahead: 60

# =========================================================================
# GLOBAL SETTINGS
# =========================================================================

global:
  # Storage settings
  storage:
    type: "postgresql"
    url: "${DATABASE_URL}"
    pool_size: 10
    max_overflow: 20

  # Logging
  logging:
    level: "INFO"
    format: "json"
    file: "logs/ingestion.log"

  # Data quality
  quality_thresholds:
    minimum_quality_score: 0.3
    timezone_confidence: 0.7

  # Enrichment services (optional)
  enrichment_services:
    geocoding:
      provider: "google"
      api_key: "${GEOCODING_API_KEY}"
      cache_ttl_hours: 720

    image_validation:
      timeout: 5
      check_accessibility: true

  # Monitoring & alerts
  monitoring:
    sentry_enabled: false
    sentry_dsn: "${SENTRY_DSN}"

    slack_enabled: false
    slack_webhook: "${SLACK_WEBHOOK}"

    alert_on:
      - "pipeline_failure"
      - "low_quality_score"
      - "api_error_rate_high"
