# Configuration for Ingestion Pipelines
# This file defines which sources are enabled, their API credentials,
# scheduling, and source-specific settings.

sources:
  
  # =========================================================================
  # RA.CO - Electronic Music Platform
  # =========================================================================
  ra_co:
    enabled: true
    base_url: "https://ra.co/graphql"
    api_key: "${RA_CO_API_KEY}"  # Set via environment variable
    
    # HTTP Settings
    request_timeout: 30
    max_retries: 3
    batch_size: 100
    rate_limit_per_second: 1.0
    
    # Scheduling
    schedule:
      type: "interval"
      interval_hours: 6
      enabled: true
      # Alternatively, use cron for more precise scheduling:
      # type: "cron"
      # cron: "0 */6 * * *"  # Every 6 hours
    
    # Enrichment options
    enrichment:
      geocoding: true              # Geocode venues if coordinates missing
      organizer_metrics: false     # Fetch organizer popularity (future)
      image_validation: true       # Validate image URLs
      artist_metadata: false       # Fetch artist info (future)
    
    # Validation rules
    validation:
      require_coordinates: false   # Soft requirement (warn but don't skip)
      require_image: false
      future_events_only: true
      days_ahead: 90               # Only fetch events within 90 days
      min_title_length: 3
      required_fields:
        - title
        - location.city
        - start_datetime
        - organizer.name
    
    # Ra.co-specific settings
    custom:
      cities:                       # Cities to fetch events for
        - "Barcelona"
        - "Berlin"
        - "London"
        - "Amsterdam"
        - "Paris"
        - "New York"
      
      event_types:                  # Types to prioritize (filter)
        - "DJ"
        - "Live"
        - "Festival"
        - "Showcase"
      
      min_capacity: 0               # Minimum venue capacity
      include_cancelled: false
  
  
  # =========================================================================
  # MEETUP - Community Events Platform
  # =========================================================================
  meetup:
    enabled: false
    base_url: "https://api.meetup.com"
    api_key: "${MEETUP_API_KEY}"
    
    request_timeout: 30
    max_retries: 3
    batch_size: 50
    rate_limit_per_second: 0.5    # Lower rate limit (stricter API)
    
    schedule:
      type: "cron"
      cron: "0 */4 * * *"           # Every 4 hours
      enabled: true
    
    enrichment:
      geocoding: true
      organizer_metrics: true
      image_validation: true
    
    validation:
      require_coordinates: false
      future_events_only: true
      days_ahead: 60
      min_attendees: 0              # Minimum confirmed attendees
    
    custom:
      group_ids:                    # Meetup group IDs to monitor
        - "1234567"
        - "7654321"
      
      categories:                   # Event categories
        - "tech"
        - "music"
        - "sports"
        - "arts"
        - "food"
      
      topics:                       # Topics to include
        - "technology"
        - "networking"
        - "dancing"
      
      min_rsvp_count: 5
      include_past_events: false


  # =========================================================================
  # TICKETMASTER - Ticketing Platform
  # =========================================================================
  ticketmaster:
    enabled: false                  # Not yet implemented
    base_url: "https://app.ticketmaster.com/discovery/v2"
    api_key: "${TICKETMASTER_API_KEY}"
    
    request_timeout: 30
    max_retries: 3
    batch_size: 200
    rate_limit_per_second: 2.0
    
    schedule:
      type: "interval"
      interval_hours: 12
      enabled: false
    
    enrichment:
      geocoding: false
      organizer_metrics: false
      image_validation: true
    
    validation:
      require_image: true           # Ticketmaster usually has images
      future_events_only: true
      days_ahead: 180               # Ticketmaster has longer lead times
    
    custom:
      countries:
        - "US"
        - "GB"
      
      classifiers:                  # Event classifications to include
        - "music"
        - "sports"
        - "arts"
      
      markets:                      # Market IDs
        - "1"      # Metropolitan areas
        - "2"


# =========================================================================
# GLOBAL SETTINGS
# =========================================================================

global:
  # Storage settings
  storage:
    type: "postgresql"
    url: "${DATABASE_URL}"
    pool_size: 10
    max_overflow: 20
  
  # Logging
  logging:
    level: "INFO"
    format: "json"  # or "text"
    file: "logs/ingestion.log"
  
  # Data quality
  quality_thresholds:
    minimum_quality_score: 0.3      # Skip events below this quality
    timezone_confidence: 0.7        # Confidence threshold for timezone inference
  
  # Enrichment services (optional)
  enrichment_services:
    geocoding:
      provider: "google"            # or "nominatim", "mapbox"
      api_key: "${GEOCODING_API_KEY}"
      cache_ttl_hours: 720          # Cache geocoding results for 30 days
    
    image_validation:
      timeout: 5                    # Seconds to wait for image response
      check_accessibility: true
  
  # Monitoring & alerts
  monitoring:
    sentry_enabled: false
    sentry_dsn: "${SENTRY_DSN}"
    
    slack_enabled: false
    slack_webhook: "${SLACK_WEBHOOK}"
    
    alert_on:
      - "pipeline_failure"
      - "low_quality_score"
      - "api_error_rate_high"
